<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>IA Vocale GitHub</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        #chat-box { width: 90%; max-width: 400px; height: 500px; background: #1e1e1e; border-radius: 15px; display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #messages { flex: 1; padding: 20px; overflow-y: auto; }
        .user { color: #00ffcc; text-align: right; margin-bottom: 10px; }
        .ai { color: #ffffff; border-left: 3px solid #00ffcc; padding-left: 10px; margin-bottom: 15px; }
        #controls { padding: 15px; display: flex; gap: 10px; border-top: 1px solid #333; }
        input { flex: 1; background: #2d2d2d; border: none; color: white; padding: 12px; border-radius: 8px; outline: none; }
        button { background: #00ffcc; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { opacity: 0.8; }
        #mic-btn { background: #ff4757; color: white; } /* Bouton micro rouge */
        #api-key-area { margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="api-key-area">
        <input type="password" id="api-key" placeholder="Ta clÃ© OpenAI ici..." style="width: 250px;">
    </div>

    <div id="chat-box">
        <div id="messages"></div>
        <div id="controls">
            <input type="text" id="user-input" placeholder="Parle ou Ã©cris...">
            <button id="mic-btn" onclick="startListening()">ðŸŽ¤</button>
            <button onclick="askAI()">Envoyer</button>
        </div>
    </div>

<script>
    // --- 1. RECONNAISSANCE VOCALE (Ã‰COUTER) ---
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'fr-FR';

    function startListening() {
        recognition.start();
        document.getElementById('mic-btn').innerText = "ðŸ›‘"; // Change l'icÃ´ne pendant l'Ã©coute
    }

    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById('user-input').value = transcript;
        document.getElementById('mic-btn').innerText = "ðŸŽ¤";
        askAI(); // Envoie automatiquement aprÃ¨s avoir parlÃ©
    };

    // --- 2. SYNTHÃˆSE VOCALE (PARLER) ---
    function speak(text) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'fr-FR';
        window.speechSynthesis.speak(utterance);
    }

    // --- 3. LOGIQUE IA ---
    async function askAI() {
        const apiKey = document.getElementById('api-key').value;
        const userInput = document.getElementById('user-input').value;
        const messagesDiv = document.getElementById('messages');

        if (!apiKey || !userInput) return;

        messagesDiv.innerHTML += `<div class="user">${userInput}</div>`;
        document.getElementById('user-input').value = "";

        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
                body: JSON.stringify({
                    model: "gpt-3.5-turbo",
                    messages: [{role: "user", content: userInput}]
                })
            });

            const data = await response.json();
            const aiText = data.choices[0].message.content;

            messagesDiv.innerHTML += `<div class="ai"><b>IA:</b> ${aiText}</div>`;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            // FAIRE PARLER L'IA
            speak(aiText);

        } catch (error) {
            alert("Erreur. VÃ©rifie ta clÃ© ou ton crÃ©dit.");
        }
    }
</script>
</body>
</html>
